{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://value-architect.example.com/deck_spec.schema.json",
  "title": "DeckSpec",
  "description": "Value Architect Agent의 덱 스펙 스키마 v2.0 - 2층 구조 (콘텐츠 스펙 + 레이아웃 스펙)",
  "type": "object",
  "required": ["client_meta", "slides"],
  "properties": {
    "client_meta": {
      "type": "object",
      "description": "클라이언트 및 프로젝트 메타데이터",
      "required": ["client_name", "industry", "date", "audience", "objective"],
      "properties": {
        "client_name": {
          "type": "string",
          "minLength": 1,
          "description": "클라이언트 이름"
        },
        "industry": {
          "type": "string",
          "minLength": 1,
          "description": "산업 분류 (예: Manufacturing, Retail, Financial Services)"
        },
        "date": {
          "type": "string",
          "pattern": "^\\d{4}-\\d{2}-\\d{2}$",
          "description": "덱 날짜 (YYYY-MM-DD 형식)"
        },
        "audience": {
          "type": "string",
          "minLength": 1,
          "description": "대상 청중 (예: C-level, Business Heads, IT Leaders)"
        },
        "objective": {
          "type": "string",
          "minLength": 1,
          "description": "덱의 목적 (예: Digital transformation roadmap)"
        },
        "language": {
          "type": "string",
          "enum": ["ko", "en", "ko-en"],
          "default": "ko",
          "description": "주 언어 (ko: 한국어, en: 영어, ko-en: 혼용)"
        },
        "version": {
          "type": "string",
          "pattern": "^v?\\d+(\\.\\d+)*$",
          "description": "덱 버전 (예: v1.0, 1.2.3)"
        },
        "author": {
          "type": "string",
          "description": "작성자"
        },
        "confidentiality": {
          "type": "string",
          "enum": ["public", "internal", "confidential", "strictly_confidential"],
          "default": "confidential",
          "description": "보안 등급"
        }
      },
      "additionalProperties": true
    },
    "global_constraints": {
      "type": "object",
      "description": "전역 제약조건 (모든 슬라이드에 적용)",
      "properties": {
        "max_slides": {
          "type": "integer",
          "minimum": 1,
          "maximum": 100,
          "default": 30,
          "description": "최대 슬라이드 수"
        },
        "default_max_bullets": {
          "type": "integer",
          "minimum": 1,
          "maximum": 10,
          "default": 6,
          "description": "기본 최대 불릿 수"
        },
        "default_max_chars_per_bullet": {
          "type": "integer",
          "minimum": 20,
          "maximum": 300,
          "default": 100,
          "description": "불릿당 기본 최대 문자 수"
        },
        "forbidden_words": {
          "type": "array",
          "items": { "type": "string" },
          "default": [],
          "description": "금지 단어 목록"
        },
        "required_sections": {
          "type": "array",
          "items": { "type": "string" },
          "description": "필수 섹션 목록"
        },
        "tone": {
          "type": "string",
          "enum": ["formal", "professional", "conversational"],
          "default": "professional",
          "description": "문서 톤"
        }
      },
      "additionalProperties": true
    },
    "assumptions": {
      "type": "array",
      "description": "분석에 사용된 가정 목록",
      "items": {
        "type": "string",
        "minLength": 1
      }
    },
    "sources_ref": {
      "type": "array",
      "description": "sources.md의 참조 앵커 (예: sources.md#market)",
      "items": {
        "type": "string"
      }
    },
    "slides": {
      "type": "array",
      "description": "슬라이드 목록",
      "minItems": 1,
      "maxItems": 50,
      "items": {
        "$ref": "#/$defs/slide"
      }
    }
  },
  "additionalProperties": true,
  "$defs": {
    "slide": {
      "type": "object",
      "description": "단일 슬라이드 정의 - 2층 구조 (콘텐츠 + 레이아웃)",
      "required": ["layout", "title", "governing_message"],
      "properties": {
        "layout": {
          "type": "string",
          "enum": [
            "cover",
            "exec_summary",
            "section_divider",
            "content",
            "two_column",
            "three_column",
            "comparison",
            "timeline",
            "process_flow",
            "chart_focus",
            "image_focus",
            "quote",
            "appendix",
            "thank_you"
          ],
          "description": "슬라이드 레이아웃 유형"
        },
        "layout_intent": {
          "type": "object",
          "description": "레이아웃 의도 (렌더러에게 구체적 지시)",
          "properties": {
            "emphasis": {
              "type": "string",
              "enum": ["content", "visual", "balanced"],
              "default": "content",
              "description": "강조점 (콘텐츠/시각/균형)"
            },
            "visual_position": {
              "type": "string",
              "enum": ["left", "right", "top", "bottom", "center", "background"],
              "description": "시각 자료 위치"
            },
            "content_density": {
              "type": "string",
              "enum": ["sparse", "normal", "dense"],
              "default": "normal",
              "description": "콘텐츠 밀도"
            },
            "animation_hint": {
              "type": "string",
              "enum": ["none", "sequential", "all_at_once"],
              "default": "none",
              "description": "애니메이션 힌트"
            }
          },
          "additionalProperties": true
        },
        "title": {
          "type": "string",
          "minLength": 1,
          "maxLength": 100,
          "description": "슬라이드 제목"
        },
        "subtitle": {
          "type": "string",
          "maxLength": 80,
          "description": "부제목 (cover, section_divider용)"
        },
        "governing_message": {
          "type": "string",
          "minLength": 1,
          "maxLength": 200,
          "description": "핵심 메시지 - 슬라이드의 'So What'"
        },
        "content_blocks": {
          "type": "array",
          "description": "콘텐츠 블록 목록 (타입별 분리)",
          "items": {
            "$ref": "#/$defs/content_block"
          }
        },
        "bullets": {
          "type": "array",
          "description": "불릿 포인트 목록 (레거시 호환 및 단순 슬라이드용)",
          "default": [],
          "maxItems": 8,
          "items": {
            "$ref": "#/$defs/bullet"
          }
        },
        "columns": {
          "type": "array",
          "description": "컬럼 기반 레이아웃용 (two_column, three_column, comparison)",
          "minItems": 2,
          "maxItems": 3,
          "items": {
            "$ref": "#/$defs/column"
          }
        },
        "visuals": {
          "type": "array",
          "description": "시각 자료 (차트, 이미지, 다이어그램)",
          "default": [],
          "items": {
            "$ref": "#/$defs/visual"
          }
        },
        "footnotes": {
          "type": "array",
          "description": "각주 목록",
          "items": {
            "$ref": "#/$defs/footnote"
          }
        },
        "notes": {
          "type": "string",
          "default": "",
          "description": "발표자 노트 (출처, 가정, 부연 설명)"
        },
        "slide_constraints": {
          "type": "object",
          "description": "슬라이드별 제약조건 (전역 제약 오버라이드)",
          "properties": {
            "max_bullets": {
              "type": "integer",
              "minimum": 1,
              "maximum": 10,
              "description": "최대 불릿 수"
            },
            "max_chars_per_bullet": {
              "type": "integer",
              "minimum": 20,
              "maximum": 300,
              "description": "불릿당 최대 문자 수"
            },
            "forbidden_words": {
              "type": "array",
              "items": { "type": "string" },
              "description": "이 슬라이드에서 금지된 단어"
            },
            "required_elements": {
              "type": "array",
              "items": {
                "type": "string",
                "enum": ["visual", "table", "chart", "quote", "footnote"]
              },
              "description": "필수 요소"
            }
          },
          "additionalProperties": true
        },
        "metadata": {
          "type": "object",
          "description": "슬라이드별 추가 메타데이터",
          "properties": {
            "source_refs": {
              "type": "array",
              "items": { "type": "string" },
              "description": "이 슬라이드에 사용된 출처 참조"
            },
            "is_optional": {
              "type": "boolean",
              "default": false,
              "description": "선택적 슬라이드 여부"
            },
            "skip_in_presentation": {
              "type": "boolean",
              "default": false,
              "description": "발표 시 건너뛸 슬라이드"
            },
            "section": {
              "type": "string",
              "description": "소속 섹션명"
            },
            "slide_number_override": {
              "type": "integer",
              "description": "슬라이드 번호 오버라이드"
            }
          },
          "additionalProperties": true
        }
      },
      "additionalProperties": true
    },
    "content_block": {
      "type": "object",
      "description": "콘텐츠 블록 - 타입별 분리된 콘텐츠 단위",
      "required": ["type"],
      "properties": {
        "type": {
          "type": "string",
          "enum": ["bullets", "table", "chart", "image", "quote", "footnote", "callout", "kpi", "text"],
          "description": "콘텐츠 블록 유형"
        },
        "position": {
          "type": "string",
          "enum": ["main", "left", "right", "top", "bottom", "sidebar"],
          "default": "main",
          "description": "블록 위치"
        },
        "evidence": {
          "$ref": "#/$defs/evidence",
          "description": "근거/출처 연결"
        },
        "bullets": {
          "type": "array",
          "items": { "$ref": "#/$defs/bullet" },
          "description": "불릿 목록 (type: bullets일 때)"
        },
        "table": {
          "$ref": "#/$defs/table_def",
          "description": "테이블 정의 (type: table일 때)"
        },
        "chart": {
          "$ref": "#/$defs/visual",
          "description": "차트 정의 (type: chart일 때)"
        },
        "image": {
          "$ref": "#/$defs/visual",
          "description": "이미지 정의 (type: image일 때)"
        },
        "quote": {
          "$ref": "#/$defs/quote_def",
          "description": "인용문 정의 (type: quote일 때)"
        },
        "callout": {
          "$ref": "#/$defs/callout_def",
          "description": "콜아웃 정의 (type: callout일 때)"
        },
        "kpi": {
          "$ref": "#/$defs/kpi_def",
          "description": "KPI 정의 (type: kpi일 때)"
        },
        "text": {
          "type": "string",
          "description": "일반 텍스트 (type: text일 때)"
        }
      },
      "additionalProperties": true
    },
    "evidence": {
      "type": "object",
      "description": "근거/출처 연결 - sources.md 앵커와 직접 연결",
      "properties": {
        "source_anchor": {
          "type": "string",
          "pattern": "^sources\\.md#.+$",
          "description": "sources.md의 앵커 (예: sources.md#market-data)"
        },
        "source_type": {
          "type": "string",
          "enum": ["primary", "secondary", "assumption", "calculation", "expert_opinion"],
          "default": "secondary",
          "description": "출처 유형"
        },
        "confidence": {
          "type": "string",
          "enum": ["high", "medium", "low"],
          "default": "medium",
          "description": "신뢰도"
        },
        "citation": {
          "type": "string",
          "description": "인라인 인용 텍스트"
        },
        "date_accessed": {
          "type": "string",
          "pattern": "^\\d{4}-\\d{2}-\\d{2}$",
          "description": "접근 날짜"
        }
      },
      "additionalProperties": true
    },
    "bullet": {
      "oneOf": [
        {
          "type": "string",
          "minLength": 1,
          "maxLength": 100,
          "description": "단순 불릿 텍스트 (최대 100자, global_constraints로 오버라이드 가능)"
        },
        {
          "type": "object",
          "description": "구조화된 불릿 (근거 연결 포함)",
          "required": ["text"],
          "properties": {
            "text": {
              "type": "string",
              "minLength": 1,
              "maxLength": 100,
              "description": "불릿 텍스트 (최대 100자, global_constraints로 오버라이드 가능)"
            },
            "level": {
              "type": "integer",
              "minimum": 0,
              "maximum": 2,
              "default": 0,
              "description": "들여쓰기 레벨 (0: 최상위, 1: 하위, 2: 하위하위)"
            },
            "emphasis": {
              "type": "string",
              "enum": ["normal", "bold", "highlight"],
              "default": "normal"
            },
            "icon": {
              "type": "string",
              "description": "불릿 앞 아이콘 (예: checkmark, arrow, star)"
            },
            "evidence": {
              "$ref": "#/$defs/evidence",
              "description": "이 불릿의 근거/출처"
            }
          },
          "additionalProperties": false
        }
      ]
    },
    "column": {
      "type": "object",
      "description": "컬럼 정의 - 구조화된 멀티컬럼 레이아웃",
      "required": ["heading"],
      "properties": {
        "heading": {
          "type": "string",
          "minLength": 1,
          "maxLength": 50,
          "description": "컬럼 제목"
        },
        "subheading": {
          "type": "string",
          "maxLength": 80,
          "description": "컬럼 부제목"
        },
        "bullets": {
          "type": "array",
          "maxItems": 6,
          "items": {
            "$ref": "#/$defs/bullet"
          }
        },
        "visual": {
          "$ref": "#/$defs/visual",
          "description": "컬럼 내 시각 자료"
        },
        "content_blocks": {
          "type": "array",
          "items": { "$ref": "#/$defs/content_block" },
          "description": "컬럼 내 콘텐츠 블록"
        },
        "highlight_color": {
          "type": "string",
          "pattern": "^#[0-9A-Fa-f]{6}$",
          "description": "강조 색상 (HEX)"
        },
        "width_ratio": {
          "type": "number",
          "minimum": 0.1,
          "maximum": 0.9,
          "description": "컬럼 너비 비율 (0.1-0.9)"
        }
      },
      "additionalProperties": false
    },
    "visual": {
      "type": "object",
      "description": "시각 자료 정의",
      "required": ["type"],
      "properties": {
        "type": {
          "type": "string",
          "enum": [
            "bar_chart",
            "line_chart",
            "pie_chart",
            "stacked_bar",
            "waterfall",
            "scatter",
            "table",
            "image",
            "icon_grid",
            "process_diagram",
            "timeline_diagram",
            "org_chart",
            "matrix",
            "placeholder"
          ],
          "description": "시각 자료 유형"
        },
        "title": {
          "type": "string",
          "maxLength": 80,
          "description": "차트/이미지 제목"
        },
        "data_path": {
          "type": "string",
          "description": "데이터 파일 경로 (CSV, JSON)"
        },
        "data_inline": {
          "type": "object",
          "description": "인라인 데이터 (간단한 차트용)",
          "properties": {
            "labels": {
              "type": "array",
              "items": { "type": "string" }
            },
            "values": {
              "type": "array",
              "items": { "type": "number" }
            },
            "series": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "name": { "type": "string" },
                  "values": {
                    "type": "array",
                    "items": { "type": "number" }
                  }
                }
              }
            }
          }
        },
        "image_path": {
          "type": "string",
          "description": "이미지 파일 경로"
        },
        "caption": {
          "type": "string",
          "maxLength": 120,
          "description": "캡션/출처"
        },
        "position": {
          "type": "string",
          "enum": ["left", "right", "center", "full", "top", "bottom"],
          "default": "center",
          "description": "배치 위치"
        },
        "size": {
          "type": "string",
          "enum": ["small", "medium", "large", "full"],
          "default": "medium",
          "description": "크기"
        },
        "evidence": {
          "$ref": "#/$defs/evidence",
          "description": "시각 자료의 근거/출처"
        }
      },
      "additionalProperties": true
    },
    "table_def": {
      "type": "object",
      "description": "테이블 정의",
      "required": ["headers", "rows"],
      "properties": {
        "headers": {
          "type": "array",
          "items": { "type": "string" },
          "minItems": 1,
          "description": "테이블 헤더"
        },
        "rows": {
          "type": "array",
          "items": {
            "type": "array",
            "items": { "type": "string" }
          },
          "description": "테이블 행"
        },
        "style": {
          "type": "string",
          "enum": ["default", "striped", "bordered", "minimal"],
          "default": "default",
          "description": "테이블 스타일"
        },
        "highlight_rows": {
          "type": "array",
          "items": { "type": "integer" },
          "description": "강조할 행 인덱스"
        },
        "evidence": {
          "$ref": "#/$defs/evidence",
          "description": "테이블 데이터의 근거/출처"
        }
      },
      "additionalProperties": true
    },
    "quote_def": {
      "type": "object",
      "description": "인용문 정의",
      "required": ["text"],
      "properties": {
        "text": {
          "type": "string",
          "minLength": 1,
          "maxLength": 500,
          "description": "인용문 텍스트"
        },
        "author": {
          "type": "string",
          "description": "인용문 출처/저자"
        },
        "role": {
          "type": "string",
          "description": "저자의 직책/역할"
        },
        "style": {
          "type": "string",
          "enum": ["standard", "large", "sidebar"],
          "default": "standard",
          "description": "인용문 스타일"
        },
        "evidence": {
          "$ref": "#/$defs/evidence",
          "description": "인용문의 근거/출처"
        }
      },
      "additionalProperties": true
    },
    "callout_def": {
      "type": "object",
      "description": "콜아웃 정의 (강조 박스)",
      "required": ["text"],
      "properties": {
        "text": {
          "type": "string",
          "minLength": 1,
          "maxLength": 200,
          "description": "콜아웃 텍스트"
        },
        "type": {
          "type": "string",
          "enum": ["info", "warning", "success", "highlight", "key_insight"],
          "default": "info",
          "description": "콜아웃 유형"
        },
        "icon": {
          "type": "string",
          "description": "콜아웃 아이콘"
        }
      },
      "additionalProperties": true
    },
    "kpi_def": {
      "type": "object",
      "description": "KPI/지표 정의",
      "required": ["label", "value"],
      "properties": {
        "label": {
          "type": "string",
          "description": "KPI 라벨"
        },
        "value": {
          "type": "string",
          "description": "KPI 값 (문자열로 표시)"
        },
        "unit": {
          "type": "string",
          "description": "단위"
        },
        "trend": {
          "type": "string",
          "enum": ["up", "down", "neutral"],
          "description": "추세"
        },
        "comparison": {
          "type": "string",
          "description": "비교 텍스트 (예: vs. LY +10%)"
        },
        "evidence": {
          "$ref": "#/$defs/evidence",
          "description": "KPI의 근거/출처"
        }
      },
      "additionalProperties": true
    },
    "footnote": {
      "type": "object",
      "description": "각주 정의",
      "required": ["text"],
      "properties": {
        "marker": {
          "type": "string",
          "maxLength": 5,
          "description": "각주 마커 (예: *, †, 1)"
        },
        "text": {
          "type": "string",
          "maxLength": 300,
          "description": "각주 텍스트"
        },
        "evidence": {
          "$ref": "#/$defs/evidence",
          "description": "각주의 근거/출처"
        }
      },
      "additionalProperties": true
    }
  }
}
